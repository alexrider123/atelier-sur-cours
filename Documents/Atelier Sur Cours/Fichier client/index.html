<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atelier Sur Cours ‚Äî Fiche Client</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    /* ‚îÄ‚îÄ Reset & base ‚îÄ‚îÄ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --dark:    #464C5F;
      --black:   #000000;
      --gold:    #FFD936;
      --gold-dk: #DAB200;
      --hover:   #6A8690;
      --bg:      #F6F8F5;
      --danger:  #c0392b;
      --muted:   #888;
      --border:  #d8d8d8;
      --gap:     1.25rem;
    }

    body {
      font-family: 'Open Sans', sans-serif;
      font-weight: 400;
      background: var(--bg);
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2.5rem 1rem 5rem;
    }

    /* ‚îÄ‚îÄ Page header (logo) ‚îÄ‚îÄ */
    .page-header {
      width: 100%;
      max-width: 780px;
      text-align: center;
      margin-bottom: 2rem;
    }
    .page-header img {
      height: 96px;
      width: auto;
    }
    .page-header .subtitle {
      font-family: 'Open Sans', sans-serif;
      font-weight: 300;
      font-size: .85rem;
      letter-spacing: .15em;
      text-transform: uppercase;
      color: var(--muted);
      margin-top: .5rem;
    }

    /* ‚îÄ‚îÄ Card wrapper ‚îÄ‚îÄ */
    .card {
      background: #fff;
      border: 1px solid #ddd;
      width: 100%;
      max-width: 780px;
      padding: 2.5rem 2.5rem;
    }

    /* ‚îÄ‚îÄ Progress indicator ‚îÄ‚îÄ */
    .progress {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2.5rem;
      font-size: .75rem;
      letter-spacing: .1em;
      text-transform: uppercase;
    }
    .progress-step {
      display: flex;
      align-items: center;
      gap: .5rem;
      color: var(--muted);
      font-family: 'Open Sans', sans-serif;
      font-weight: 300;
    }
    .progress-step.active {
      color: var(--dark);
      font-weight: 600;
    }
    .progress-step.done { color: var(--muted); }
    .progress-step .dot {
      width: 22px; height: 22px;
      border: 1px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      font-size: .7rem; font-weight: 600;
    }
    .progress-step.active .dot {
      background: var(--dark);
      border-color: var(--dark);
      color: #fff;
    }
    .progress-step.done .dot {
      background: var(--muted);
      border-color: var(--muted);
      color: #fff;
    }
    .progress-divider {
      width: 48px; height: 1px;
      background: var(--border);
    }

    /* ‚îÄ‚îÄ Section labels ‚îÄ‚îÄ */
    .section-label {
      font-family: 'Open Sans', sans-serif;
      font-size: .7rem;
      font-weight: 600;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--muted);
      border-bottom: 1px solid var(--border);
      padding-bottom: .5rem;
      margin-bottom: 1rem;
      margin-top: 1.75rem;
      grid-column: 1 / -1;
    }
    .section-label:first-child { margin-top: 0; }

    /* ‚îÄ‚îÄ Form grid ‚îÄ‚îÄ */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: .4rem;
    }
    .field.full { grid-column: 1 / -1; }

    label {
      font-size: .8rem;
      font-weight: 600;
      letter-spacing: .04em;
      color: var(--dark);
      text-transform: uppercase;
    }
    label .req { color: var(--danger); margin-left: 2px; }

    input, textarea, select {
      border: 1px solid var(--border);
      border-radius: 0;
      padding: .65rem .85rem;
      font-size: .95rem;
      font-family: 'Open Sans', sans-serif;
      font-weight: 300;
      transition: border-color .2s;
      background: #fff;
      color: var(--dark);
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--dark);
    }
    input.invalid, textarea.invalid, select.invalid {
      border-color: var(--danger);
    }
    textarea { resize: vertical; min-height: 90px; }
    select {
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23888'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right .85rem center;
      background-size: .65rem;
      padding-right: 2.5rem;
      cursor: pointer;
    }

    .field-error {
      font-size: .78rem;
      color: var(--danger);
      display: none;
    }
    .field-error.show { display: block; }

    /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .75rem 2rem;
      border-radius: 0;
      border: 1px solid var(--black);
      background: #fff;
      color: var(--black);
      font-family: 'Open Sans', sans-serif;
      font-size: .8rem;
      font-weight: 600;
      letter-spacing: .1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background .2s, color .2s;
    }
    .btn:hover {
      background: var(--hover);
      color: #fff;
      border-color: var(--hover);
    }
    .btn:active { opacity: .85; }
    .btn:disabled {
      opacity: .5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--dark);
      color: #fff;
      border-color: var(--dark);
    }
    .btn-primary:hover {
      background: var(--hover);
      border-color: var(--hover);
    }

    .btn-confirm {
      background: var(--dark);
      color: #fff;
      border-color: var(--dark);
    }
    .btn-confirm:hover {
      background: var(--hover);
      border-color: var(--hover);
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 2rem;
    }

    /* ‚îÄ‚îÄ Screen toggling ‚îÄ‚îÄ */
    #screen-form, #screen-summary, #screen-success { display: none; }
    #screen-form.active,
    #screen-summary.active,
    #screen-success.active { display: block; }

    /* ‚îÄ‚îÄ Summary screen ‚îÄ‚îÄ */
    .summary-intro {
      font-family: 'Playfair Display', serif;
      font-size: 1.05rem;
      color: var(--dark);
      margin-bottom: 1.75rem;
      padding-bottom: 1.25rem;
      border-bottom: 1px solid var(--border);
    }

    .summary-block {
      border: 1px solid var(--border);
      margin-bottom: 1.25rem;
    }
    .summary-block-title {
      background: var(--dark);
      color: #fff;
      padding: .45rem 1rem;
      font-size: .68rem;
      font-weight: 600;
      letter-spacing: .12em;
      text-transform: uppercase;
    }
    .summary-row {
      display: flex;
      align-items: baseline;
      padding: .6rem 1rem;
      border-bottom: 1px solid #f2f2f2;
    }
    .summary-row:last-child { border-bottom: none; }
    .summary-key {
      font-size: .72rem;
      font-weight: 600;
      letter-spacing: .07em;
      text-transform: uppercase;
      color: var(--muted);
      width: 38%;
      flex-shrink: 0;
    }
    .summary-val {
      font-size: .92rem;
      font-weight: 400;
      color: var(--dark);
      white-space: pre-wrap;
      word-break: break-word;
    }
    .summary-val:empty::after {
      content: '‚Äî';
      color: #ccc;
    }

    .summary-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2rem;
      gap: 1rem;
      flex-wrap: wrap;
    }

    /* ‚îÄ‚îÄ Spinner ‚îÄ‚îÄ */
    .spinner {
      width: 16px; height: 16px;
      border: 2px solid rgba(255,255,255,.4);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin .7s linear infinite;
      display: none;
    }
    .spinner.show { display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Error banner ‚îÄ‚îÄ */
    .error-banner {
      display: none;
      background: #fdf2f2;
      border: 1px solid #f5c6cb;
      color: var(--danger);
      padding: .75rem 1rem;
      font-size: .875rem;
      margin-top: 1rem;
    }
    .error-banner.show { display: block; }

    /* ‚îÄ‚îÄ Success screen ‚îÄ‚îÄ */
    .success-box {
      text-align: center;
      padding: 3.5rem 1rem;
    }
    .success-mark {
      width: 52px; height: 52px;
      border: 2px solid var(--dark);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 1.5rem;
      font-size: 1.4rem;
      color: var(--dark);
    }
    .success-box h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.6rem;
      color: var(--dark);
      margin-bottom: .75rem;
    }
    .success-box p {
      font-size: .9rem;
      font-weight: 300;
      color: var(--muted);
      line-height: 1.7;
    }

    /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
    .page-footer {
      width: 100%;
      max-width: 780px;
      text-align: center;
      margin-top: 1.5rem;
      font-size: .72rem;
      font-weight: 300;
      color: var(--muted);
      letter-spacing: .04em;
    }
    .page-footer a {
      color: var(--muted);
      text-decoration: underline;
      text-underline-offset: 3px;
    }
    .page-footer a:hover { color: var(--dark); }

    /* ‚îÄ‚îÄ Phone field ‚îÄ‚îÄ */
    .phone-wrapper {
      position: relative;
      display: flex;
      align-items: stretch;
    }
    .phone-country-trigger {
      display: flex;
      align-items: center;
      gap: .35rem;
      padding: .65rem .7rem;
      border: 1px solid var(--border);
      border-right: none;
      background: #f7f7f7;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      font-family: 'Open Sans', sans-serif;
      font-size: .88rem;
      color: var(--dark);
      transition: border-color .2s;
    }
    .phone-country-trigger:hover { background: #efefef; }
    .phone-caret { font-size: .6rem; color: var(--muted); margin-left: .1rem; }
    .phone-wrapper:focus-within .phone-country-trigger { border-color: var(--dark); }
    .phone-wrapper input[type="tel"] { border-left: none; flex: 1; min-width: 0; }

    .phone-country-dropdown {
      display: none;
      flex-direction: column;
      position: absolute;
      top: calc(100% + 2px);
      left: 0;
      z-index: 200;
      background: #fff;
      border: 1px solid var(--border);
      width: 270px;
      max-height: 260px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0,0,0,.10);
    }
    .phone-country-dropdown.open { display: flex; }
    .phone-search {
      border: none !important;
      border-bottom: 1px solid var(--border) !important;
      padding: .5rem .8rem !important;
      font-size: .85rem !important;
      font-family: 'Open Sans', sans-serif !important;
      outline: none !important;
      flex-shrink: 0;
      color: var(--dark) !important;
    }
    .phone-country-list {
      list-style: none;
      overflow-y: auto;
      flex: 1;
    }
    .phone-country-list li {
      display: flex;
      align-items: center;
      gap: .5rem;
      padding: .45rem .8rem;
      font-size: .83rem;
      cursor: pointer;
      color: var(--dark);
    }
    .phone-country-list li:hover { background: var(--bg); }
    .phone-country-list li.selected { font-weight: 600; background: #f0f0f0; }
    .phone-country-list .c-code { color: var(--muted); font-size: .78rem; margin-left: auto; }

    /* ‚îÄ‚îÄ Pays country select ‚îÄ‚îÄ */
    .country-select-wrapper { position: relative; }
    .country-select-trigger {
      display: flex;
      align-items: center;
      gap: .5rem;
      padding: .65rem .85rem;
      border: 1px solid var(--border);
      background: #fff;
      cursor: pointer;
      user-select: none;
      font-family: 'Open Sans', sans-serif;
      font-size: .95rem;
      font-weight: 300;
      color: var(--dark);
      transition: border-color .2s;
    }
    .country-select-trigger:hover { border-color: #bbb; }
    .country-select-trigger.open,
    .country-select-trigger.open { border-color: var(--dark); }
    .country-select-trigger .phone-caret { margin-left: auto; }
    .country-select-dropdown {
      display: none;
      flex-direction: column;
      position: absolute;
      top: calc(100% + 2px);
      left: 0; right: 0;
      z-index: 200;
      background: #fff;
      border: 1px solid var(--border);
      max-height: 240px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0,0,0,.10);
    }
    .country-select-dropdown.open { display: flex; }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 600px) {
      .card { padding: 1.5rem 1.25rem; }
      .form-grid { grid-template-columns: 1fr; }
      .field.full { grid-column: 1; }
      .progress { gap: .6rem; font-size: .7rem; }
      .progress-divider { width: 24px; }
      .summary-key { width: 45%; }
    }
  </style>
</head>
<body>

<!-- Logo -->
<div class="page-header">
  <img src="logo.png" alt="Atelier Sur Cours" />
  <p class="subtitle">Coordonn√©es client</p>
</div>

<div class="card">

  <!-- Progress indicator -->
  <div class="progress" id="progress-bar">
    <div class="progress-step active" id="step1-indicator">
      <div class="dot">1</div>
      <span>Informations</span>
    </div>
    <div class="progress-divider"></div>
    <div class="progress-step" id="step2-indicator">
      <div class="dot">2</div>
      <span>Confirmation</span>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCREEN 1 : FORM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-form" class="active">
    <form id="client-form" novalidate>
      <div class="form-grid">

        <!-- Entreprise -->
        <div class="section-label">Entreprise</div>

        <div class="field">
          <label for="nomEntreprise">Nom entreprise</label>
          <input type="text" id="nomEntreprise" name="nomEntreprise" autocomplete="organization" />
        </div>

        <div class="field">
          <label for="siren">SIREN</label>
          <input type="text" id="siren" name="siren" maxlength="14" />
        </div>

        <!-- Contact -->
        <div class="section-label">Contact</div>

        <div class="field full">
          <label for="civilite">Civilit√© <span class="req">*</span></label>
          <select id="civilite" name="civilite">
            <option value="">‚Äî S√©lectionner ‚Äî</option>
            <option value="Monsieur">Monsieur</option>
            <option value="Madame">Madame</option>
          </select>
          <span class="field-error" id="err-civilite">Champ requis.</span>
        </div>

        <div class="field">
          <label for="nom">Nom <span class="req">*</span></label>
          <input type="text" id="nom" name="nom" autocomplete="family-name" />
          <span class="field-error" id="err-nom">Champ requis.</span>
        </div>

        <div class="field">
          <label for="prenom">Pr√©nom <span class="req">*</span></label>
          <input type="text" id="prenom" name="prenom" autocomplete="given-name" />
          <span class="field-error" id="err-prenom">Champ requis.</span>
        </div>

        <div class="field">
          <label for="telephone">T√©l√©phone <span class="req">*</span></label>
          <div class="phone-wrapper">
            <div class="phone-country-trigger" id="phoneCountryTrigger" data-code="+33">
              <span id="phoneFlag">üá´üá∑</span>
              <span id="phoneCode">+33</span>
              <span class="phone-caret">‚ñæ</span>
            </div>
            <div class="phone-country-dropdown" id="phoneCountryDropdown">
              <input type="text" id="phoneSearch" class="phone-search" placeholder="Rechercher un pays‚Ä¶" autocomplete="off" />
              <ul class="phone-country-list" id="phoneCountryList"></ul>
            </div>
            <input type="tel" id="telephone" name="telephone" autocomplete="tel" placeholder="6 11 22 33 44" />
          </div>
          <span class="field-error" id="err-telephone">Champ requis.</span>
        </div>

        <div class="field">
          <label for="email">Email <span class="req">*</span></label>
          <input type="email" id="email" name="email" autocomplete="email" />
          <span class="field-error" id="err-email">Adresse e-mail invalide.</span>
        </div>

        <!-- Adresse -->
        <div class="section-label">Adresse</div>

        <div class="field full">
          <label for="adresse">Adresse <span class="req">*</span></label>
          <input type="text" id="adresse" name="adresse" autocomplete="street-address" />
          <span class="field-error" id="err-adresse">Champ requis.</span>
        </div>

        <div class="field">
          <label for="codePostal">Code Postal <span class="req">*</span></label>
          <input type="text" id="codePostal" name="codePostal" autocomplete="postal-code" maxlength="10" />
          <span class="field-error" id="err-codePostal">Champ requis.</span>
        </div>

        <div class="field">
          <label for="ville">Ville <span class="req">*</span></label>
          <input type="text" id="ville" name="ville" autocomplete="address-level2" />
          <span class="field-error" id="err-ville">Champ requis.</span>
        </div>

        <div class="field">
          <label>Pays <span class="req">*</span></label>
          <input type="hidden" id="pays" name="pays" value="France" />
          <div class="country-select-wrapper" id="paysWrapper">
            <div class="country-select-trigger" id="paysTrigger">
              <span id="paysFlag">üá´üá∑</span>
              <span id="paysName">France</span>
              <span class="phone-caret">‚ñæ</span>
            </div>
            <div class="country-select-dropdown" id="paysDropdown">
              <input type="text" id="paysSearch" class="phone-search" placeholder="Rechercher un pays‚Ä¶" autocomplete="off" />
              <ul class="phone-country-list" id="paysCountryList"></ul>
            </div>
          </div>
          <span class="field-error" id="err-pays">Champ requis.</span>
        </div>

        <!-- Notes -->
        <div class="section-label">Notes</div>

        <div class="field full">
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" placeholder="Informations compl√©mentaires‚Ä¶"></textarea>
        </div>

      </div><!-- /form-grid -->

      <div class="form-actions">
        <button type="button" class="btn btn-primary" id="btn-next">
          Suivant ‚Üí
        </button>
      </div>
    </form>
  </div><!-- /screen-form -->

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCREEN 2 : SUMMARY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-summary">

    <p class="summary-intro">Veuillez v√©rifier vos informations avant de confirmer l'envoi.</p>

    <!-- Entreprise -->
    <div class="summary-block">
      <div class="summary-block-title">Entreprise</div>
      <div class="summary-row">
        <span class="summary-key">Nom entreprise</span>
        <span class="summary-val" id="s-nomEntreprise"></span>
      </div>
      <div class="summary-row">
        <span class="summary-key">SIREN</span>
        <span class="summary-val" id="s-siren"></span>
      </div>
    </div>

    <!-- Contact -->
    <div class="summary-block">
      <div class="summary-block-title">Contact</div>
      <div class="summary-row">
        <span class="summary-key">Civilit√©</span>
        <span class="summary-val" id="s-civilite"></span>
      </div>
      <div class="summary-row">
        <span class="summary-key">Nom</span>
        <span class="summary-val" id="s-nom"></span>
      </div>
      <div class="summary-row">
        <span class="summary-key">Pr√©nom</span>
        <span class="summary-val" id="s-prenom"></span>
      </div>
      <div class="summary-row">
        <span class="summary-key">T√©l√©phone</span>
        <span class="summary-val" id="s-telephone"></span>
      </div>
      <div class="summary-row">
        <span class="summary-key">Email</span>
        <span class="summary-val" id="s-email"></span>
      </div>
    </div>

    <!-- Adresse -->
    <div class="summary-block">
      <div class="summary-block-title">Adresse</div>
      <div class="summary-row">
        <span class="summary-key">Adresse</span>
        <span class="summary-val" id="s-adresse"></span>
      </div>
      <div class="summary-row">
        <span class="summary-key">Code Postal</span>
        <span class="summary-val" id="s-codePostal"></span>
      </div>
      <div class="summary-row">
        <span class="summary-key">Ville</span>
        <span class="summary-val" id="s-ville"></span>
      </div>
      <div class="summary-row">
        <span class="summary-key">Pays</span>
        <span class="summary-val" id="s-pays"></span>
      </div>
    </div>

    <!-- Notes -->
    <div class="summary-block">
      <div class="summary-block-title">Notes</div>
      <div class="summary-row">
        <span class="summary-key">Notes</span>
        <span class="summary-val" id="s-notes"></span>
      </div>
    </div>

    <div class="error-banner" id="error-banner">
      Une erreur s'est produite lors de l'envoi. Veuillez r√©essayer.
      <br><strong id="error-detail"></strong>
    </div>

    <div class="summary-actions">
      <button type="button" class="btn" id="btn-back">
        ‚Üê Modifier
      </button>
      <button type="button" class="btn btn-confirm" id="btn-confirm">
        <span class="spinner" id="spinner"></span>
        <span id="btn-confirm-label">Confirmer et envoyer</span>
      </button>
    </div>

  </div><!-- /screen-summary -->

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCREEN 3 : SUCCESS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-success">
    <div class="success-box">
      <div class="success-mark">‚úì</div>
      <h2>Merci !</h2>
      <p>Vos informations ont bien √©t√© enregistr√©es.</p>
    </div>
  </div>

</div><!-- /card -->

<!-- Footer RGPD -->
<footer class="page-footer">
  En soumettant ce formulaire, vous acceptez notre&nbsp;
  <a href="rgpd.html" target="_blank">Politique de confidentialit√© (RGPD)</a>.
</footer>

<script>
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  CONFIGURATION
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyz7ak5fX4aHv_V58VWWx5MM14yxwPWWWYhwxLCIJNY9Wba28mEfjwzIZ42SG3nD4zGXw/exec';

  const $ = id => document.getElementById(id);

  // ‚îÄ‚îÄ Country dial-code data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const COUNTRIES = [
    { flag: 'üá´üá∑', name: 'France',                code: '+33'  },
    { flag: 'üá©üáø', name: 'Alg√©rie',               code: '+213' },
    { flag: 'üá©üá™', name: 'Allemagne',             code: '+49'  },
    { flag: 'üá¶üá¥', name: 'Angola',                code: '+244' },
    { flag: 'üá∏üá¶', name: 'Arabie saoudite',       code: '+966' },
    { flag: 'üá¶üá∑', name: 'Argentine',             code: '+54'  },
    { flag: 'üá¶üá∫', name: 'Australie',             code: '+61'  },
    { flag: 'üá¶üáπ', name: 'Autriche',              code: '+43'  },
    { flag: 'üáßüá™', name: 'Belgique',              code: '+32'  },
    { flag: 'üáßüá∑', name: 'Br√©sil',                code: '+55'  },
    { flag: 'üáßüá´', name: 'Burkina Faso',          code: '+226' },
    { flag: 'üá®üá≤', name: 'Cameroun',              code: '+237' },
    { flag: 'üá®üá¶', name: 'Canada',                code: '+1'   },
    { flag: 'üá®üá≥', name: 'Chine',                 code: '+86'  },
    { flag: 'üá®üáÆ', name: "C√¥te d'Ivoire",         code: '+225' },
    { flag: 'üá©üá∞', name: 'Danemark',              code: '+45'  },
    { flag: 'üá™üá¨', name: '√âgypte',                code: '+20'  },
    { flag: 'üá¶üá™', name: '√âmirats arabes unis',   code: '+971' },
    { flag: 'üá™üá∏', name: 'Espagne',               code: '+34'  },
    { flag: 'üá∫üá∏', name: '√âtats-Unis',            code: '+1'   },
    { flag: 'üá´üáÆ', name: 'Finlande',              code: '+358' },
    { flag: 'üá¨üá¶', name: 'Gabon',                 code: '+241' },
    { flag: 'üá¨üá≠', name: 'Ghana',                 code: '+233' },
    { flag: 'üá¨üá∑', name: 'Gr√®ce',                 code: '+30'  },
    { flag: 'üá¨üá≥', name: 'Guin√©e',                code: '+224' },
    { flag: 'üáÆüá≥', name: 'Inde',                  code: '+91'  },
    { flag: 'üáÆüá©', name: 'Indon√©sie',             code: '+62'  },
    { flag: 'üáÆüá±', name: 'Isra√´l',                code: '+972' },
    { flag: 'üáÆüáπ', name: 'Italie',                code: '+39'  },
    { flag: 'üáØüáµ', name: 'Japon',                 code: '+81'  },
    { flag: 'üáØüá¥', name: 'Jordanie',              code: '+962' },
    { flag: 'üá∞üá™', name: 'Kenya',                 code: '+254' },
    { flag: 'üá±üáß', name: 'Liban',                 code: '+961' },
    { flag: 'üá±üáæ', name: 'Libye',                 code: '+218' },
    { flag: 'üá±üá∫', name: 'Luxembourg',            code: '+352' },
    { flag: 'üá≤üá¨', name: 'Madagascar',            code: '+261' },
    { flag: 'üá≤üá±', name: 'Mali',                  code: '+223' },
    { flag: 'üá≤üá¶', name: 'Maroc',                 code: '+212' },
    { flag: 'üá≤üáΩ', name: 'Mexique',               code: '+52'  },
    { flag: 'üá≥üá±', name: 'Pays-Bas',              code: '+31'  },
    { flag: 'üá≥üá¨', name: 'Nig√©ria',               code: '+234' },
    { flag: 'üá≥üá¥', name: 'Norv√®ge',               code: '+47'  },
    { flag: 'üáµüá∞', name: 'Pakistan',              code: '+92'  },
    { flag: 'üáµüáπ', name: 'Portugal',              code: '+351' },
    { flag: 'üá®üá©', name: 'RD Congo',              code: '+243' },
    { flag: 'üá®üá¨', name: 'R√©publique du Congo',   code: '+242' },
    { flag: 'üá∑üá¥', name: 'Roumanie',              code: '+40'  },
    { flag: 'üá¨üáß', name: 'Royaume-Uni',           code: '+44'  },
    { flag: 'üá∑üá∫', name: 'Russie',                code: '+7'   },
    { flag: 'üá∏üá≥', name: 'S√©n√©gal',               code: '+221' },
    { flag: 'üá∏üá¨', name: 'Singapour',             code: '+65'  },
    { flag: 'üá∏üá™', name: 'Su√®de',                 code: '+46'  },
    { flag: 'üá®üá≠', name: 'Suisse',                code: '+41'  },
    { flag: 'üáπüá≥', name: 'Tunisie',               code: '+216' },
    { flag: 'üáπüá∑', name: 'Turquie',               code: '+90'  },
  ];

  let selectedCountry = COUNTRIES[0];

  function buildCountryList(filter = '') {
    const list = $('phoneCountryList');
    list.innerHTML = '';
    const q = filter.toLowerCase();
    COUNTRIES
      .filter(c => !q || c.name.toLowerCase().includes(q) || c.code.includes(q))
      .forEach(c => {
        const li = document.createElement('li');
        if (c === selectedCountry) li.classList.add('selected');
        li.innerHTML = `<span>${c.flag}</span><span>${c.name}</span><span class="c-code">${c.code}</span>`;
        li.addEventListener('mousedown', (e) => { e.preventDefault(); selectCountry(c); });
        list.appendChild(li);
      });
  }

  function selectCountry(c) {
    selectedCountry = c;
    $('phoneFlag').textContent = c.flag;
    $('phoneCode').textContent = c.code;
    $('phoneCountryTrigger').dataset.code = c.code;
    closeDropdown();
  }

  function openDropdown() {
    $('phoneCountryDropdown').classList.add('open');
    $('phoneSearch').value = '';
    buildCountryList();
    setTimeout(() => $('phoneSearch').focus(), 50);
  }

  function closeDropdown() {
    $('phoneCountryDropdown').classList.remove('open');
  }

  $('phoneCountryTrigger').addEventListener('click', (e) => {
    e.stopPropagation();
    $('phoneCountryDropdown').classList.contains('open') ? closeDropdown() : openDropdown();
  });

  $('phoneSearch').addEventListener('input', (e) => buildCountryList(e.target.value));
  $('phoneSearch').addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDropdown(); });

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.phone-wrapper')) closeDropdown();
    if (!e.target.closest('#paysWrapper')) closePaysList();
  });

  // ‚îÄ‚îÄ Pays country select ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let selectedPays = COUNTRIES.find(c => c.name === 'France') || COUNTRIES[0];

  function buildPaysList(filter = '') {
    const list = $('paysCountryList');
    list.innerHTML = '';
    const q = filter.toLowerCase();
    COUNTRIES
      .filter(c => !q || c.name.toLowerCase().includes(q))
      .forEach(c => {
        const li = document.createElement('li');
        if (c === selectedPays) li.classList.add('selected');
        li.innerHTML = `<span>${c.flag}</span><span>${c.name}</span>`;
        li.addEventListener('mousedown', (e) => { e.preventDefault(); selectPays(c); });
        list.appendChild(li);
      });
  }

  function selectPays(c) {
    selectedPays = c;
    $('paysFlag').textContent = c.flag;
    $('paysName').textContent = c.name;
    $('pays').value = c.name;
    closePaysList();
  }

  function openPaysList() {
    $('paysDropdown').classList.add('open');
    $('paysTrigger').classList.add('open');
    $('paysSearch').value = '';
    buildPaysList();
    setTimeout(() => $('paysSearch').focus(), 50);
  }

  function closePaysList() {
    $('paysDropdown').classList.remove('open');
    $('paysTrigger').classList.remove('open');
  }

  $('paysTrigger').addEventListener('click', (e) => {
    e.stopPropagation();
    $('paysDropdown').classList.contains('open') ? closePaysList() : openPaysList();
  });
  $('paysSearch').addEventListener('input', (e) => buildPaysList(e.target.value));
  $('paysSearch').addEventListener('keydown', (e) => { if (e.key === 'Escape') closePaysList(); });

  // ‚îÄ‚îÄ Screens ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showScreen(name) {
    ['screen-form', 'screen-summary', 'screen-success'].forEach(id => {
      $(id).classList.remove('active');
    });
    $('screen-' + name).classList.add('active');

    if (name === 'form') {
      $('step1-indicator').className = 'progress-step active';
      $('step2-indicator').className = 'progress-step';
    } else if (name === 'summary') {
      $('step1-indicator').className = 'progress-step done';
      $('step2-indicator').className = 'progress-step active';
    }
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // ‚îÄ‚îÄ Form data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const FIELDS = [
    'nomEntreprise', 'siren',
    'civilite', 'nom', 'prenom', 'telephone', 'email',
    'adresse', 'codePostal', 'ville', 'pays',
    'notes'
  ];

  function collectFormData() {
    const data = {};
    FIELDS.forEach(f => {
      if (f === 'telephone') {
        const code = $('phoneCountryTrigger').dataset.code || '+33';
        const num  = $('telephone').value.trim().replace(/^0+/, '');
        data.telephone = num ? `${code.replace('+', '')} ${num}` : '';
      } else {
        data[f] = $(f).value.trim();
      }
    });
    return data;
  }

  // ‚îÄ‚îÄ Validation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const REQUIRED = ['civilite', 'nom', 'prenom', 'telephone', 'email', 'adresse', 'codePostal', 'ville', 'pays'];

  function validateForm() {
    let valid = true;

    FIELDS.forEach(f => {
      $(f).classList.remove('invalid');
      const err = $('err-' + f);
      if (err) err.classList.remove('show');
    });

    REQUIRED.forEach(f => {
      const el = $(f);
      if (!el.value.trim()) {
        el.classList.add('invalid');
        const err = $('err-' + f);
        if (err) { err.textContent = 'Champ requis.'; err.classList.add('show'); }
        valid = false;
      }
    });

    const emailEl = $('email');
    if (emailEl.value.trim() && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailEl.value.trim())) {
      emailEl.classList.add('invalid');
      const err = $('err-email');
      if (err) { err.textContent = 'Adresse e-mail invalide.'; err.classList.add('show'); }
      valid = false;
    }

    return valid;
  }

  // ‚îÄ‚îÄ Summary ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderSummary(data) {
    FIELDS.forEach(f => {
      const el = $('s-' + f);
      if (el) el.textContent = data[f] || '';
    });
  }

  // ‚îÄ‚îÄ Submission ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function submitToSheet(data) {
    const spinner     = $('spinner');
    const btnLabel    = $('btn-confirm-label');
    const btnConfirm  = $('btn-confirm');
    const errorBanner = $('error-banner');
    const errorDetail = $('error-detail');

    spinner.classList.add('show');
    btnLabel.textContent = 'Envoi en cours‚Ä¶';
    btnConfirm.disabled = true;
    errorBanner.classList.remove('show');

    try {
      const response = await fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify(data),
      });

      if (!response.ok) throw new Error('HTTP ' + response.status);

      const json = await response.json();
      if (json.status !== 'success') throw new Error(json.message || 'R√©ponse inattendue.');

      showScreen('success');

    } catch (err) {
      errorDetail.textContent = err.message || '';
      errorBanner.classList.add('show');
    } finally {
      spinner.classList.remove('show');
      btnLabel.textContent = 'Confirmer et envoyer';
      btnConfirm.disabled = false;
    }
  }

  // ‚îÄ‚îÄ Events ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  $('btn-next').addEventListener('click', () => {
    if (!validateForm()) return;
    renderSummary(collectFormData());
    showScreen('summary');
  });

  $('btn-back').addEventListener('click', () => {
    $('error-banner').classList.remove('show');
    showScreen('form');
  });

  $('btn-confirm').addEventListener('click', () => {
    submitToSheet(collectFormData());
  });

  FIELDS.forEach(f => {
    const el = $(f);
    if (!el) return;
    el.addEventListener('input', () => {
      el.classList.remove('invalid');
      const err = $('err-' + f);
      if (err) err.classList.remove('show');
    });
  });

  showScreen('form');
</script>
</body>
</html>
